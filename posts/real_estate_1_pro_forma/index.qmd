---
title: "Real Estate Valuation with R: Chapter 1 - Uncertainty"
subtitle: | 
  Get in, loser, we're generating deviates.
date: "2023/20/01"
format: 
  html:
    fig-width: 8
    fig-height: 4
    code-fold: false
execute:
  freeze: auto
# image: image
categories: [real estate]
draft: true
---

I'm trying to build some functions that calculate how much a real estate project is worth. I want to re-run those functions a few (thousand) times to explore the impact of the values I think are better viewed as probabilistic. Here, I show my thought process in how I'm approaching these random values.

```{r}
#| include: false

library(tidyr)
library(tibble)
library(ggplot2)
```

## Introducing the unknowns

In my commercial real estate project, there are three main categories of values that might vary:

1.  Construction - how long construction and renovation in the building might take\
2.  Lease-Up Period - how long we should expect it to take to reach stable vacancy rates\
3.  Vacancy Rates - how much stable vacancy we should expect

We might expect renovations to take 2 years, with a lease-up period of 2 years until we reach a stable office vacancy rate of 15%. What if construction takes longer? What if the market is strong and we fill office leases within one year? What if a pandemic causes stable vacancy to be closer to 30%?

It would be prudent for any of my models to account for that uncertainty. I don't know enough about real estate or the future make good estimates about how to represent the kind of uncertainty a commercial real estate project would face. Ideally, I would seek the opinions of experts with access to better information, but there's no money on the line here, so I'll make something up that seems close enough.

## Modeling the unknowns: 2 approaches

I will use two different methods for generating random scenarios for the project. The first is the `sample()` function, which lets me sample outcomes from a discrete set of outcomes and weights. The second is the `rbeta()` function, which lets me generate random deviates of custom [beta distributions](https://en.wikipedia.org/wiki/Beta_distribution). I haven't been exposed to the type of statistics that would make me familiar with beta distributions; I just googled types of random distributions that fit my version of a highly right-skewed distribution. I think this matches my vision of the small chance of high vacancy rates above some baseline rate.

### Discrete sampling for small sample spaces

For construction delays and lease-up periods, I am only dealing with small ranges of 0-5 years. To make things simpler, I am only modeling discrete integer outcomes. The accounting won't care about half-years of construction; I will only consider construction "done" on the year it finishes.

Discrete samples can be drawn by giving vectors of outcomes and probability weights to the `sample()` function. This function assumes you are drawing **without replacement** so you will need to set `replace = TRUE` if you are repeating the same drawing multiple times.

Below is an example for modeling construction times. I estimate construction and renovation to take 2 years, with a roughly a 10% likelihood of a 1-year delay, a roughly 1% likelihood of a 2-year delay, and a 0.1% likelihood of a 3-year delay. We can simulate 50,000 outcomes of this sample like so:

```{r}
set.seed(1234) # helps me reproduce outcomes predictably
n = 50000 # number of rows

# store sample draws to dataframe
df <- tibble(
  construction_term=sample(
    2:5,
    n,
    replace=TRUE,
    prob=c(0.9,0.09,0.009,0.001)
  )
)
```

Showing a histogram of these outcomes is going to show us what we expect: $ {prob} * n $ instances of each outcome, more or less. 

```{r}
#| code-fold: show
#| label: hist-construction
#| fig-cap: Simulated Outcomes for Construction Term

df %>%
  ggplot(data=.,aes(x=construction_term)) +
  geom_histogram(
    bins = length(unique(df$construction_term)),
    fill='blue'
  ) +
  ggtitle('Construction Term Frequencies, n=50,000') +
  xlab('Number of Years') + 
  ylab('Frequency') +
  theme_classic()
```

lorem ipsum

code chunks of both cases

histograms/other graphics of both cases

last section

## Further Reading

A neat overview of techniques in group decision making and forecasting can be found [here](https://doi.org/10.1093/acrefore/9780190236557.013.262).

I spent an hour trying to understand beta distributions from Wikipedia [here](https://en.wikipedia.org/wiki/Beta_distribution). I don't fully understand them yet but I'll keep the page open on my phone's browser until I do.

A detailed exploration of random distributions in Microsoft Excel can be found [here](https://cameron.econ.ucdavis.edu/excel/ex23normaltprobabilities.html) (though do consider whether you should still be in a spreadsheet at this point).

Some great refreshers of random distributions in R can be found: \* [here](https://rstudio-pubs-static.s3.amazonaws.com/100906_8e3a32dd11c14b839468db756cee7400.html) and \* [here](https://www.huber.embl.de/users/kaspar/biostat_2021/2-demo.html) and

The R `stats` package documentation on distributions is [here](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/Distributions.html).
